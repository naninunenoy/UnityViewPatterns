@startuml BMIAppArchitecture

package BMIApp {
    /'
    package CleanArchitecture {
        interface ISceneMain
        interface IUseCase {
            void Begin()
        }
        interface IPresenter
        interface IVew
        interface IRepostiroy
        interface IDataStore
        interface IController
        interface IEntity
    }
    '/
    package Login {
        class LoginMain
        class AuthUseCase
        class AlertUseCase
        class SceneTransitionUseCase
        interface IAuthResultDelegate {
            void OnAuthSuccess()
            void OnAuthFailure()
        }
        interface IAuthController
        class DummyAuthController {
            Task<string> TryGetTokenAsync(string, string)
        }
        interface ILoginPressenter {
            IReadOnlyReactiveProperty IdInput { get }
            IReadOnlyReactiveProperty PasswordInput { get }
            IObservable<Unit> LoginButtonClickObservable { get }
            void Begin()
            void SetLoginButtonInteractive(bool)
        }
        class LoginPresenter
        interface ILoginView {
            InputField IdInputField { get }
            InputField PasswordInputField { get }
            Button LoginButton { get }
        }
        class LoginView
        interface IAlertPresenter {
            IObservable<Unit> CloseButtonClickObservable { get }
            void Begin()
            void Open(string)
            void Close()
        }
        class AlertPresenter
        interface IAlertView {
            Button CloseButton { get }
            Text AlertText { get }
            Transform ViewTransform { get }
        }
        class AlertView
    }
    package BMI {
        class BMISceneMain
        class BMIUseCase
        class HistoryUseCase
        class LogoutUseCase
        interface IPushHistoryDelegate {
            void OnPushBMIEntity(IBMIEntity)
        }
        interface IBMIPresenter {
            IReadOnlyReactiveProperty<string> NameInput { get }
            IReadOnlyReactiveProperty<string> HeightInput { get }
            IReadOnlyReactiveProperty<string> WeightInput { get }
            IReadOnlyReactiveProperty<string> AgeInput { get }
            IReadOnlyReactiveProperty<bool> GenderMaleSelect { get }
            IReadOnlyReactiveProperty<bool> GenderFemaleSelect { get }
            IObservable<Unit> SaveButtonClickObservable { get }
            void Begin()
            void SetBMIResult(string)
            void SetSaveButtonEnable(bool)
        }
        class BMIPresenter
        interface IBMIView {
            InputField NameInput { get }
            InputField HeightInput { get }
            InputField WeightInput { get }
            InputField AgeInput { get }
            Toggle GenderMaleToggle { get }
            Toggle GenderFemaleToggle { get }
            Text BMIText { get }
            Button SaveButton { get }
        }
        class BMIView
        interface IHistoryListPresenter {
            IObservable<Unit> ClearButtonClickObservable { get }
            void Add(string, string, string)
            void ClearList()
        }
        class HistoryListPresenter
        interface IHisotryView {
            Button ClearButton { get }
            Transform ViewTransform { get }
        }
        class HistoryView
        interface IHistoryElmView {
            Text DateText { get }
            Text NameText { get }
            Text BMIText { get }
            IHistoryElmView Clone(Transform);
        }
        class HistoryElmView
        interface IAccountPresenter {
            void Begin()
            IObservable<Unit> LogoutButtonClickObservable { get }
            void SetAccountText(string)
        }
        class AccountPresenter
        interface IAccountView {
            Button LogoutButon { get }
            Text AccountNameText { get }
        }
        class AccountView
        enum Gender {
            None
            Male
            Female
        }
        interface IBMIEntity {
            string Name { set get }
            float Height { set get }
            float Weight { set get }
            int Age { set get }
            Gender Gender { set get }
            float BMI { set get }
            DateTime CreatedAt { set get }
        }
        class BMIEntity
        class BMIEntityArray
        interface IHistoryRepository {
            Task SaveAsync(IBMIEntity data)
            Task<IEnumerable<IBMIEntity>> LoadAllAsync()
            Task DeleteAllAsync()
        }
        class HistoryRepository
        interface IHistoryDataStore {
            IList<IBMIEntity> Datas { get }
            Task LoadAsync();
            Task SaveAsync();
            Task DeleteAsync();
        }
        class PlayerPrefsHistoryDataStore
        class TemporaryHistoryDataStore
    }

    interface IUserAccountRepository {
        string CurrentUserId { set get }
        string CurrentUserToken { set get }
        void Clear()
    }
    class UserAccountRepository
    interface ISharedDataStore {
        string CurrentUserId { set get }
        string CurrentUserToken { set get }
        void Clear()
    }
    class SharedScriptableObject
}

'' ログインシーン
LoginMain -down-> AuthUseCase
LoginMain -down-> AlertUseCase
LoginMain -down-> SceneTransitionUseCase

AuthUseCase .down.> ILoginPressenter
AuthUseCase .up.> IAuthResultDelegate
LoginPresenter .up.|> ILoginPressenter
LoginPresenter .down.> ILoginView
AuthUseCase .down.> IUserAccountRepository
LoginView .up.|> ILoginView
UserAccountRepository .up.|> IUserAccountRepository
SharedScriptableObject .up.|> ISharedDataStore
UserAccountRepository .down.> ISharedDataStore
AuthUseCase .down.> IAuthController
DummyAuthController .up.|> IAuthController

AlertUseCase .down.> IAlertPresenter
AlertUseCase .up.|> IAuthResultDelegate
AlertPresenter .up.|> IAlertPresenter
AlertView .up.|> IAlertView
AlertPresenter .down.> IAlertView

SceneTransitionUseCase .up.|> IAuthResultDelegate

'' BMIシーン
BMISceneMain -down-> BMIUseCase
BMISceneMain -down-> HistoryUseCase
BMISceneMain -down-> LogoutUseCase

IBMIEntity -up-> Gender
BMIEntity .down.|> IBMIEntity
IHistoryDataStore -up-> IBMIEntity
IHistoryRepository -up-> IBMIEntity
BMIEntityArray -right-> BMIEntity
PlayerPrefsHistoryDataStore ---> BMIEntityArray

BMIUseCase .up.> IPushHistoryDelegate
BMIUseCase .down.> IBMIPresenter
BMIPresenter .up.|> IBMIPresenter
BMIPresenter .down.> IBMIView
BMIView .up.|> IBMIView

HistoryUseCase .up.|> IPushHistoryDelegate
HistoryUseCase .down.> IHistoryListPresenter
HistoryListPresenter .up.|> IHistoryListPresenter
HistoryListPresenter .down.> IHisotryView
HistoryListPresenter .down.> IHistoryElmView
HistoryView .up.|> IHisotryView
HistoryElmView .up.|> IHistoryElmView
HistoryUseCase .down.> IHistoryRepository
HistoryRepository .up.|> IHistoryRepository
HistoryRepository .down.> IHistoryDataStore
TemporaryHistoryDataStore .up.|> IHistoryDataStore
PlayerPrefsHistoryDataStore .up.|> IHistoryDataStore

LogoutUseCase .down.> IUserAccountRepository
LogoutUseCase .down.> IAccountPresenter
AccountPresenter .up.|> IAccountPresenter
AccountPresenter .down.> IAccountView
AccountView .up.|> IAccountView

@enduml
